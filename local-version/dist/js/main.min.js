window.onload=function(){function e(e){var t=e.split("");return t.splice(4,0,"/"),t.splice(7,0,"/"),t=t.join(""),e.substring(4,6)+"月"+e.substring(6,8)+"日 星期"+"日一二三四五六".charAt(new Date(t).getDay())}function t(t){var n=document.createElement("h2"),o=document.createElement("ul");n.innerHTML="20170308"==t.date?"今日新闻":e(t.date);for(var i=0,r=t.stories.length;i<r;i++){var s=document.createElement("li"),a=document.createElement("a"),l=document.createElement("h3"),d=document.createElement("img");o.className="news-list clearfix",a.classList.add("news"),a.newsid=t.stories[i].id,l.innerHTML=t.stories[i].title,d.src=t.stories[i].images[0],d.alt=t.stories[i].title,a.appendChild(l),a.appendChild(d),s.appendChild(a),o.appendChild(s)}c.appendChild(n),c.appendChild(o)}function n(){var e=document.querySelectorAll(".news");Array.from(e).forEach(function(e,t){e.addEventListener("click",function(){window.location.href="/zhihudaily/local-version/views/article.html?newsid="+e.newsid},!1)})}function o(){function e(e){for(var t=0,n=e.parentNode;n;)t+=e.offsetTop,e=n,n=n.parentNode;return t}var o=document.getElementsByTagName("h2")[0];title=document.querySelector(".title");e(o);window.onscroll=function(){var i=document.documentElement.scrollTop||document.body.scrollTop,c=document.querySelector(".content"),r=(c.clientHeight,!0);c.clientHeight+e(c)<i+window.innerHeight&&r&&(r=!1,ajax({url:"20170306.json",type:"get",success:function(e){e=JSON.parse(e),t(e),n(),r=!0},error:function(e){console.log(e)}})),i>=0&&i<200&&(title.innerHTML="首页"),i>=200&&(title.innerHTML=o.innerHTML)}}var i="1"==localStorage.getItem("isLogin"),c=document.querySelector(".content");!function(){function e(e){for(var t=e.top_stories.length,n=0;n<t;n++){var o=document.querySelector(".carousel-news"),i=document.createElement("a"),c=document.createElement("img"),r=document.createElement("span");i.classList.add("news"),i.newsid=e.top_stories[n].id,c.src=e.top_stories[n].image,r.innerHTML=e.top_stories[n].title,i.appendChild(c),i.appendChild(r),o.appendChild(i)}}ajax({url:"20170308.json",type:"GET",success:function(i){i=JSON.parse(i),e(i),t(i),n(),o()},error:function(e){console.log(e)}})}(),function(){var e=document.querySelector(".carousel-news"),t=document.querySelector(".carousel-ctrl"),n=t.getElementsByTagName("li"),o=e.clientWidth,i=0;e.timer=setInterval(function(){i++,i%=5,e.style.left=-o/5*i+"px",Array.from(n).forEach(function(e,t){e.classList.remove("active")}),n[i].classList.add("active")},3e3)}(),function(){var e=document.querySelector("#setting"),t=document.querySelector(".set-list");e.addEventListener("click",function(e){t.classList.add("show"),e.stopPropagation()},!1),document.addEventListener("click",function(){t.classList.contains("show")&&t.classList.remove("show")},!1)}(),function(){var e=document.querySelector("#sidebar-ctrl"),t=document.querySelector(".sidebar"),n=document.body;e.addEventListener("click",function(){t.classList.contains("show")||(this.classList.add("active"),t.classList.add("show"));var o=document.createElement("div");o.className="mask",n.appendChild(o),o.addEventListener("click",function(i){e.classList.remove("active"),t.classList.remove("show"),n.removeChild(o),i.stopPropagation()},!1)},!1)}(),function(){var e=document.querySelector("#night"),t=document.getElementsByTagName("head")[0];e.addEventListener("click",function(e){if(document.querySelector("#nightPattern"))setTimeout(function(){t.removeChild(document.querySelector("#nightPattern"))},100);else{var n=document.createElement("link");n.href="src/css/night.css",n.rel="stylesheet",n.id="nightPattern",setTimeout(function(){t.appendChild(n)},100)}e.stopPropagation()},!1)}(),function(){function e(){i?(n.src="src/img/avatar.png",o.innerHTML="小学生",localStorage.setItem("isLogin","1")):(n.src="src/img/nobody.jpg",o.innerHTML="未登陆",localStorage.setItem("isLogin","0"))}var t=document.querySelector(".user"),n=t.querySelector("img"),o=t.querySelector("span");e(),n.addEventListener("click",function(){i=!i,e()},!1)}()};